{{>header}}



<div class="container" >
    <div id="detailSimulation" class="col-sm-offset-3 col-sm-7">
    <table class="table table-striped">
       
            <thead>
                <tr>
                    <th><h4>Tu simulación</h4></th>
                
                    <th class="text-right"> <button type="button" id="modify" class="btn btn-default btn-sm">Modificar</button></th>
                </tr>
            </thead>
             <tbody>
            <tr>
                <td><span class="brandName"></span> <span class="modelName"></span></td>
            
                <td class="versionPrice text-right"></td>
            </tr>
        
                <td>Adelanto</td>
                
                <td class="cashAdvance text-right"></td>
            </tr>
            <tr>
                <td>Auto Usado</td>
                
                <td class="usedCar text-right"></td>
            </tr>
            <tr>
                <td>Monto a Financiar</td>
                
                <td class="amountToFinance text-right"></td>
            </tr>
            <tr>
                <td>Cuota</td>
                
                <td class="feeValue text-right"></td>
            </tr>
        
        </tbody>
    </table>

    </div>




<div class="col-sm-offset-3 col-sm-7 ">
    <h3>Personalizá tu Financiación </h3>
    <span>Completá los siguientes datos del formulario</span>
<div class="row">
   
    <form id="formDatos" >
 
        <div class="form-group">
            <label for="dni">DNI:</label>
            <input type="number" class="form-control" name="dni" id="dni">
        </div>
        <label for="gender">Sexo:</label>
        <div class="btn-group btn-group-justified" role="group" aria-label="...">

            <div class="btn-group" role="group">
                <button type="button" value="M" class="btn btn-default gender">Hombre</button>
            </div>

            <div class="btn-group" role="group">
                <button type="button" value="F" class="btn btn-default gender">Mujer</button>
            </div>
        </div>
        <br>
        <div class="form-group">
            <label for="email">E-mail:</label>
            <input name='mail' type="email" class="form-control" id="email">
        </div>
        <div class="form-group">
            <div class="row">
                <div class="col-xs-4">
                    <label for="block">Cod. Area:</label>
                    <input class="form-control" name="block" id="block" type="number" placeholder="ej 011">
                </div>
                <div class="col-xs-8">
                    <label for="phone">Número:</label>
                    <input class="form-control" name="phone" id="phone" type="number" placeholder="ej 45557345">
                </div>
            </div>


        </div>
        <div class="form-group">
            <label for="income">Ingresos Mensuales:</label>
            <input type="number" class="form-control" id="income">
        </div>


        <div class="alert alert-danger errors" hidden></div>
        <button type="button" id="submit" class="btn btn-primary btn-block">Buscar opciones de Financiación </button>

    </form>
</div>

</div>

</div>
<br>

{{>footer}}

<script>


     var vehicleBlock    = JSON.parse(localStorage.getItem("vehicleBlock"));
     var cashAdvance     = localStorage.getItem("cashAdvance");
     var usedCar         = localStorage.getItem("usedCar");
     var fee             = localStorage.getItem("fee");
     var amountToFinance = localStorage.getItem("amountToFinance");
     var modelSlug       = localStorage.getItem("modelSlug");
     var pageVersion     = "";

     var localPageVersion     = localStorage.getItem("pageVersion");

     if(localPageVersion){
         pageVersion = localPageVersion;
     }

     $('#modify').click(function(){

         window.location.href = '/'+vehicleBlock.vehicle.make.name+'/model'+pageVersion+'/'+modelSlug;
       
     })
     
    $('.brandName').html(capitalizeFirstLetter(vehicleBlock.vehicle.make.name));
    $('.modelName').html(capitalizeFirstLetter(vehicleBlock.vehicle.model.name));
    $('.versionName').html(vehicleBlock.vehicle.trim.name);
    $('.versionPrice').html(formatPrice(vehicleBlock.vehicle.trim.price));
    $('.cashAdvance').html(formatPrice(cashAdvance));
    $('.usedCar').html(formatPrice(usedCar));
    $('.feeValue').html(formatPrice(fee));
    $('.amountToFinance').html('<b>'+formatPrice(amountToFinance)+'</b>');


 

    var formData = new Object();
    var gender;
    var formFields = [
        {
            name: 'dni',
            regExp: /^[0-9]{5,10}$/,
            errorMessage: 'Por favor ingrese su DNI'
        },
        {
            name: 'mail',
            regExp: /^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i,
            errorMessage: 'El email ingresado es inv&aacute;lido.'
        }

    ]

    $('.gender').click(function () {


        $('.gender').removeClass('btn-success');
        $(this).removeClass('btn-default').addClass('btn-success');
        $(this).addClass('selectedGender');


    });

   


    $('input').change(function(){
        $(this).addClass('btn-success');
    })
    



    $('#submit').click(function () {

        dataLayer.push({
        'event':'analyticsEvent',
        'eventCategory': 'button',
        'eventAction': 'press',
        'eventLabel': 'Buscar Opciones',
        'eventValue': 0
        });

        var $errors = $('.errors');
        $errors.hide();

        function validateForm() {

            $errors.empty().hide();

            for (var index = 0; index < formFields.length; index++) {

                var formField = formFields[index];
                var formFieldElement = $('[name="' + formField.name + '"]');

                if (formFieldElement.prop('tagName') === 'SELECT'
                    && typeof formFieldElement.find(':selected').data(formField.data) === 'undefined'
                    || formFieldElement.prop('tagName') === 'INPUT'
                    && !formFieldElement.val().trim().match(formField.regExp)) {
                    showError(formField.errorMessage);
                    return false;
                }
            }

            var prefix = $("input[name='block']").val();

            if (prefix === '') {

                showError('Ingrese el código de area');

                return false;

            }

            var phone = $("input[name='phone']").val();

            if (phone === '') {

                showError('Ingrese un número de teléfono');

                return false;

            }
            gender = $('.selectedGender').val();

            if (!gender) {

                showError('Por favor selecciones su género ');

                return false;

            }



        }

        function showError(errorMessage) {
            $errors.append('<span>' + errorMessage + '</span>');
            $errors.fadeIn();
        }





        if (false !== validateForm()) {
            goToByScroll('.loader-container');
            $('.loader-container').fadeIn();


            var phoneData = new Object();

            $.each($('input'), function () {

                var thisKey = $(this).attr('id');




                switch (thisKey) {
                    case 'dni':
                        formData.document = $(this).val();
                        break;
                    case 'email':
                        formData.email = $(this).val();
                        break;
                    case 'block':
                        phoneData.prefix = $(this).val();
                        break;
                    case 'phone':
                        phoneData.block = $(this).val();
                        break;
                    default:
                        'tu vieja'
                }

            });



            formData.phone = phoneData;
            formData.gender = gender;

            var income = $('#income').val();
            var dni = $('#dni').val();

            var finance = checkFinance(income, gender, dni);

            finance.then(function (response) {


                var financialInstruments = IFcall(response);


                formData.name = response.data.person.name;
                formData.surname = response.data.person.surname;

                financialInstruments.then(function (rpta) {

                    localStorage.setItem('IFS', JSON.stringify(rpta));

                });


                console.log(formData);

               localStorage.setItem('formData', JSON.stringify(formData));

                var Fee = parseInt(localStorage.getItem('fee'));

                callNMF(null, null, null, "form");

                window.setTimeout(function () {

                window.location.href = "/"+vehicleBlock.vehicle.make.name.toLowerCase()+"/results/opciones-financiacion";

                }, 1500);

            });



        }
    });








</script>